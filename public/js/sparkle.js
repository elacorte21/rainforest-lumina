function Sparkle(t,i){this.options=i,this.init(t)}$.fn.sparkleh=function(t){return this.each(function(i,o){var a=$(o).css("position","relative");new Sparkle(a,$.extend({width:a.outerWidth(),height:a.outerHeight(),color:"#FFFFFF",count:30,overlap:0,speed:1},t)).over()})},Sparkle.prototype={init:function(t){this.$canvas=$("<canvas>").addClass("sparkle-canvas").css({position:"absolute",top:"-"+this.options.overlap+"px",left:"-"+this.options.overlap+"px","pointer-events":"none"}).appendTo(t),this.canvas=this.$canvas[0],this.context=this.canvas.getContext("2d"),this.sprite=new Image,this.sprites=[0,6,13,20],this.sprite.src=this.datauri,this.canvas.width=this.options.width+2*this.options.overlap,this.canvas.height=this.options.height+2*this.options.overlap,this.particles=this.createSparkles(this.canvas.width,this.canvas.height),this.anim=null,this.fade=!1},createSparkles:function(t,i){for(var o=[],a=0;a<this.options.count;a++){var s=this.options.color;"rainbow"==this.options.color?s="#"+("000000"+Math.floor(16777215*Math.random()).toString(16)).slice(-6):"array"===$.type(this.options.color)&&(s=this.options.color[Math.floor(Math.random()*this.options.color.length)]),o[a]={position:{x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*i)},style:this.sprites[Math.floor(4*Math.random())],delta:{x:Math.floor(1e3*Math.random())-500,y:Math.floor(1e3*Math.random())-500},size:parseFloat((2*Math.random()).toFixed(2)),color:s}}return o},draw:function(t,i){var o=this.context;o.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a=0;a<this.options.count;a++){var s=this.particles[a],n=Math.floor(7*Math.random());Math.floor(t)%n==0&&(s.style=this.sprites[Math.floor(4*Math.random())]),o.save(),o.globalAlpha=s.opacity,o.drawImage(this.sprite,s.style,0,7,7,s.position.x,s.position.y,7,7),this.options.color&&(o.globalCompositeOperation="source-atop",o.globalAlpha=.5,o.fillStyle=s.color,o.fillRect(s.position.x,s.position.y,7,7)),o.restore()}},update:function(){var t=this;this.anim=window.requestAnimationFrame(function(i){for(var o=0;o<t.options.count;o++){var a=t.particles[o],s=Math.random()>2*Math.random(),n=Math.random()>3*Math.random();s&&(a.position.x+=a.delta.x*t.options.speed/1500),n||(a.position.y-=a.delta.y*t.options.speed/800),a.position.x>t.canvas.width?a.position.x=-7:a.position.x<-7&&(a.position.x=t.canvas.width),a.position.y>t.canvas.height?(a.position.y=-7,a.position.x=Math.floor(Math.random()*t.canvas.width)):a.position.y<-7&&(a.position.y=t.canvas.height,a.position.x=Math.floor(Math.random()*t.canvas.width)),t.fade?a.opacity-=.02:a.opacity-=.005,a.opacity<=0&&(a.opacity=t.fade?0:1)}t.draw(i),t.fade?(t.fadeCount-=1,t.fadeCount<0?window.cancelAnimationFrame(t.anim):t.update()):t.update()})},cancel:function(){this.fadeCount=100},over:function(){window.cancelAnimationFrame(this.anim);for(var t=0;t<this.options.count;t++)this.particles[t].opacity=Math.random();this.fade=!1,this.update()},out:function(){this.fade=!0,this.cancel()},datauri:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAHCAYAAAD5wDa1AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzI5NkVFNDE3MkIwMTFFODlGQjI4QjcyRDEzNURCNEEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzI5NkVFNDA3MkIwMTFFODlGQjI4QjcyRDEzNURCNEEiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjM0M0UzMzlEQTIyRTExRTM4QTc0QjdDRTVBQjMxNzg2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjM0M0UzMzlFQTIyRTExRTM4QTc0QjdDRTVBQjMxNzg2Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+FOSgawAAAOpJREFUeNq8ksuKAjEQRY2KLTK68Ynu/ABBweXgx7tUFPwHxfax0UG0wWROwVUaaXRn4FCpdKhbldsuhJDLWs655547pC6kc0IBSop3SOwTRFCHNlTgAjEci7k3S0XzBntP9BI1gZoK/sAf7OAqoQEMoQEHWMLqrZiEyur2ZsUkWpLQGLqwgbkKd2AEE2ipCWs6zr8Un2ZMFek5IuWPJ6xCD/qKNTVhd5tqpqVoeeV1st+UZ0FT3HRk0csX8+gMa+U22Um+mUd7+RQ0meWXT8/o5UOivVcTiYrNMjzbwkJCac9i982/8V+AAQAC0WneOuRIaAAAAABJRU5ErkJggg=="},$.fn.imagesLoaded=function(t){var i=this.filter("img"),o=i.length,a="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return i.bind("load.imgloaded",function(){--o<=0&&this.src!==a&&(i.unbind("load.imgloaded"),t.call(i,this))}).each(function(){if(this.complete||void 0===this.complete){var t=this.src;this.src=a,this.src=t}}),this};